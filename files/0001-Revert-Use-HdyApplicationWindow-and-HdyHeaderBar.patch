From f8295d8d36291975b6a84e96c2f882b863c41ddd Mon Sep 17 00:00:00 2001
From: Joshua Strobl <joshua@streambits.io>
Date: Sat, 17 Apr 2021 04:11:05 +0300
Subject: [PATCH 1/5] Revert "Use HdyApplicationWindow and HdyHeaderBar"

This reverts commit 70aa88d18a3e8215db9f9b15be55fdeae051b55d.
---
 data/ui/app-window.ui         | 53 ++++++++++++++++++-----------------
 data/ui/collection-toolbar.ui |  2 +-
 data/ui/display-toolbar.ui    |  2 +-
 data/ui/selection-toolbar.ui  |  2 +-
 src/app-window.vala           |  2 +-
 src/collection-toolbar.vala   |  2 +-
 src/display-toolbar.vala      |  2 +-
 src/selection-toolbar.vala    |  2 +-
 8 files changed, 34 insertions(+), 33 deletions(-)

diff --git a/data/ui/app-window.ui b/data/ui/app-window.ui
index 187e2848..897df7a1 100644
--- a/data/ui/app-window.ui
+++ b/data/ui/app-window.ui
@@ -7,29 +7,30 @@
     window = new Boxes.ApplicationWindow ();
      |
      |-> main_vbox = new Gtk.Box (Gtk.Orientation.VERTICAL, 0);
-           |-> topbar = new Boxes.Topbar (); // as titlebar
-           |
-           |-> searchbar = new Searchbar ();
-           |
-           |-> notification_overlay = new Gtk.Overlay ();
-           |    |
-           |    |-> notificationbar = Boxes.Notificationbar ();
-           |    |
-           |    |-> below_bin = new Gtk.Stack ();
-           |        |
-           |        |-> icon_view = new Boxes.IconView ();
-           |        |
-           |        |-> list_view = new Boxes.ListView ();
-           |        |
-           |        |-> empty_boxes = new Boxes.EmptyBoxes ();
-           |        |
-           |        |-> display_page = new Boxes.DisplayPage ();
-           |
-           |-> selectionbar = new Boxes.Selectionbar ();
+     |     |
+     |     |-> searchbar = new Searchbar ();
+     |     |
+     |     |-> notification_overlay = new Gtk.Overlay ();
+     |     |    |
+     |     |    |-> notificationbar = Boxes.Notificationbar ();
+     |     |    |
+     |     |    |-> below_bin = new Gtk.Stack ();
+     |     |        |
+     |     |        |-> icon_view = new Boxes.IconView ();
+     |     |        |
+     |     |        |-> list_view = new Boxes.ListView ();
+     |     |        |
+     |     |        |-> empty_boxes = new Boxes.EmptyBoxes ();
+     |     |        |
+     |     |        |-> display_page = new Boxes.DisplayPage ();
+     |     |
+     |     |-> selectionbar = new Boxes.Selectionbar ();
+     |
+     |-> topbar = new Boxes.Topbar (); // as titlebar
 
   -->
 
-  <template class="BoxesAppWindow" parent="HdyApplicationWindow">
+  <template class="BoxesAppWindow" parent="GtkApplicationWindow">
     <property name="visible">False</property>
     <property name="show-menubar">False</property>
     <property name="title" translatable="yes">Boxes</property>
@@ -48,12 +49,6 @@
         <property name="hexpand">True</property>
         <property name="vexpand">True</property>
 
-        <child>
-          <object class="BoxesTopbar" id="topbar">
-            <property name="visible" bind-source="BoxesAppWindow" bind-property="fullscreened" bind-flags="invert-boolean">True</property>
-          </object>
-        </child>
-
         <child>
           <object class="BoxesSearchbar" id="searchbar">
             <property name="visible">True</property>
@@ -167,5 +162,11 @@
         </child>
       </object>
     </child>
+
+    <child type="titlebar">
+      <object class="BoxesTopbar" id="topbar">
+        <property name="visible">True</property>
+      </object>
+    </child>
   </template>
 </interface>
diff --git a/data/ui/collection-toolbar.ui b/data/ui/collection-toolbar.ui
index 7465f04a..bdf90683 100644
--- a/data/ui/collection-toolbar.ui
+++ b/data/ui/collection-toolbar.ui
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <interface>
   <!-- interface-requires gtk+ 3.9 -->
-  <template class="BoxesCollectionToolbar" parent="HdyHeaderBar">
+  <template class="BoxesCollectionToolbar" parent="GtkHeaderBar">
     <property name="visible">True</property>
     <property name="show-close-button">True</property>
     <property name="title" translatable="yes">Boxes</property>
diff --git a/data/ui/display-toolbar.ui b/data/ui/display-toolbar.ui
index 11e5e90f..e8e0d6c6 100644
--- a/data/ui/display-toolbar.ui
+++ b/data/ui/display-toolbar.ui
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <interface>
   <!-- interface-requires gtk+ 3.9 -->
-  <template class="BoxesDisplayToolbar" parent="HdyHeaderBar">
+  <template class="BoxesDisplayToolbar" parent="GtkHeaderBar">
     <property name="visible">True</property>
     <style>
       <class name="titlebar"/>
diff --git a/data/ui/selection-toolbar.ui b/data/ui/selection-toolbar.ui
index d1b92241..f97c1bd7 100644
--- a/data/ui/selection-toolbar.ui
+++ b/data/ui/selection-toolbar.ui
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <interface>
   <!-- interface-requires gtk+ 3.9 -->
-  <template class="BoxesSelectionToolbar" parent="HdyHeaderBar">
+  <template class="BoxesSelectionToolbar" parent="GtkHeaderBar">
     <property name="visible">True</property>
     <property name="show-close-button">False</property>
     <style>
diff --git a/src/app-window.vala b/src/app-window.vala
index 7ee13cbc..3ffe66da 100644
--- a/src/app-window.vala
+++ b/src/app-window.vala
@@ -3,7 +3,7 @@
 using Gdk;
 
 [GtkTemplate (ui = "/org/gnome/Boxes/ui/app-window.ui")]
-private class Boxes.AppWindow: Hdy.ApplicationWindow, Boxes.UI {
+private class Boxes.AppWindow: Gtk.ApplicationWindow, Boxes.UI {
     public const uint TRANSITION_DURATION = 400; // milliseconds
 
     public enum ViewType {
diff --git a/src/collection-toolbar.vala b/src/collection-toolbar.vala
index 09b3bd20..8781df20 100644
--- a/src/collection-toolbar.vala
+++ b/src/collection-toolbar.vala
@@ -2,7 +2,7 @@
 using Gtk;
 
 [GtkTemplate (ui = "/org/gnome/Boxes/ui/collection-toolbar.ui")]
-private class Boxes.CollectionToolbar: Hdy.HeaderBar {
+private class Boxes.CollectionToolbar: HeaderBar {
     [GtkChild]
     private unowned Button search_btn;
     [GtkChild]
diff --git a/src/display-toolbar.vala b/src/display-toolbar.vala
index 4f75cc61..51e2b5fe 100644
--- a/src/display-toolbar.vala
+++ b/src/display-toolbar.vala
@@ -2,7 +2,7 @@
 using Gtk;
 
 [GtkTemplate (ui = "/org/gnome/Boxes/ui/display-toolbar.ui")]
-private class Boxes.DisplayToolbar: Hdy.HeaderBar {
+private class Boxes.DisplayToolbar: Gtk.HeaderBar {
     public bool overlay { get; construct; }
     public bool handle_drag { get; construct; } // Handle drag events to (un)fulscreen the main window
 
diff --git a/src/selection-toolbar.vala b/src/selection-toolbar.vala
index ecba773f..4976b349 100644
--- a/src/selection-toolbar.vala
+++ b/src/selection-toolbar.vala
@@ -2,7 +2,7 @@
 using Gtk;
 
 [GtkTemplate (ui = "/org/gnome/Boxes/ui/selection-toolbar.ui")]
-private class Boxes.SelectionToolbar: Hdy.HeaderBar {
+private class Boxes.SelectionToolbar: HeaderBar {
     [GtkChild]
     private unowned Button search_btn;
     [GtkChild]
-- 
2.32.0

